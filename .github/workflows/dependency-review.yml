name: Dependencies Review & Audit

on:
  workflow_call: # SRC: https://docs.github.com/en/actions/using-workflows/reusing-workflows
    inputs:
      # github-actions-common/.../checkout
      ssh-private-key:
        type: string
        description: SSH private key
        required: false

      #
      # NOTE: vvv github-actions-python/.../setup
      python-version-file:
        type: string
        description: Python version to install
        required: false
        default: "" # auto-detect

      python-version:
        type: string
        description: Python version to install
        required: false
        default: ""

      architecture:
        type: string
        description: Architecture to install python
        required: false
        default: x64
      # NOTE: ^^^ github-actions-python/.../setup

      #
      # NOTE: vvv github-actions-pip/.../install-upgrade
      pip_cli_options:
        type: string
        description: Options to pass to the pip command
        required: false
        default: "--verbose"

      upgrade-requirements-file:
        type: string
        description: Path to the requirements file
        required: false
        default: ./requirements.upgrade.txt
      # NOTE: ^^^ github-actions-pip/.../install-upgrade

      #
      # NOTE: github-actions-pipx/.../run_pip-audit
      audit-requirements-file:
        type: string
        description: Path to the requirements file
        required: false
        default: ./requirements.txt

permissions:
  contents: read

jobs:
  dependency-review:
    uses: percebus/github-actions-compliance/.github/workflows/dependency-review.yml@main
    with:
      ssh-private-key: ${{ inputs.ssh-private-key }}
    permissions:
      contents: read
      pull-requests: read

  # NOTE: is this job redundant?
  # does dependency-review-action accomplish the same, and more?
  audit:
    uses: percebus/github-actions-pipx/.github/workflows/run_pip-audit.yml@main
    with:
      # github-actions-common/.../checkout
      ssh-private-key: ${{ inputs.ssh-private-key }}

      # github-actions-python/.../setup
      python-version-file: ${{ inputs.python-version-file }}
      python-version: ${{ inputs.python-version }}
      architecture: ${{ inputs.architecture }}

      # github-actions-pip/.../install-upgrade
      pip_cli_options: ${{ inputs.pip_cli_options }}
      upgrade-requirements-file: ${{ inputs.upgrade-requirements-file }}

      # github-actions-pipx/.../run_pip-audit
      audit-requirements-file: ${{ inputs.audit-requirements-file }}
